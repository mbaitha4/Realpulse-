<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Shabadam - UP & Bihar News</title>

<!-- SEO -->
<meta name="description" content="Shabadam - Latest Breaking News from Uttar Pradesh & Bihar. Hindi & English News, Politics, Technology, Sports & Business Updates.">
<meta name="keywords" content="UP News, Bihar News, Hindi News, English News, Breaking News, Shabadam">
<meta name="author" content="Shabadam">
<meta property="og:title" content="Shabadam - UP & Bihar News">
<meta property="og:description" content="Latest breaking news from Uttar Pradesh and Bihar in Hindi & English.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://shabadam.com/">
<meta property="og:image" content="https://shabadam.com/logo.png">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://shabadam.com/">

<!-- Google Discover Optimization -->
<meta name="googlebot" content="max-image-preview:large">
<meta name="news_keywords" content="Uttar Pradesh News, Bihar News, Hindi News, Breaking News">

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#E4405F">

<style>
/* (Same styling as before â€” unchanged to keep answer compact) */
</style>
</head>

<body data-theme="light">

<header>
<div class="logo" id="appLogo">Shabadam</div>
<button class="lang-btn" onclick="toggleLang()">English / à¤¹à¤¿à¤‚à¤¦à¥€</button>
</header>

<div class="ticker">
<span id="breakingNews">Loading breaking news...</span>
</div>

<div class="cat-bar" id="catBar"></div>

<div id="feed"></div>
<div id="loader" style="text-align:center;padding:10px;">Loading...</div>

<footer>
<button onclick="location.reload()">ğŸ </button>
<button onclick="openLogin()">âœï¸</button>
<button onclick="toggleTheme()">ğŸŒ™</button>
</footer>

<!-- LOGIN -->
<div class="modal" id="loginModal">
<div class="modal-content">
<h3>Editor Login</h3>
<input id="editorUser" placeholder="Username">
<input id="editorPass" type="password" placeholder="Password">
<button onclick="editorLogin()">Login</button>
<button onclick="closeLogin()">Close</button>
</div>
</div>

<!-- EDITOR DASHBOARD -->
<div class="modal" id="editorModal">
<div class="modal-content">
<h3>Editor Dashboard</h3>
<input id="titleInput" placeholder="Title">
<textarea id="descInput" rows="4" placeholder="Content"></textarea>
<input type="file" onchange="handleImageUpload(event)">
<img id="previewImg" style="width:100%;display:none;margin-bottom:10px;border-radius:10px;">
<select id="catInput"></select>
<button onclick="publishArticle()">Publish</button>
<hr>
<h4>Manage Articles</h4>
<div id="manageList"></div>
<button onclick="closeEditor()">Close</button>
</div>
</div>

<script>

let state={page:1,category:"general",lang:"en",loading:false,finished:false};
let uploadedImage=null;

const EDITOR_USERNAME="editor";
const EDITOR_PASSWORD="Realpulse123";

const categories=[
{id:"general",en:"General",hi:"à¤¸à¤¾à¤®à¤¾à¤¨à¥à¤¯"},
{id:"nation",en:"Nation",hi:"à¤°à¤¾à¤·à¥à¤Ÿà¥à¤°à¥€à¤¯"},
{id:"business",en:"Business",hi:"à¤µà¥à¤¯à¤¾à¤ªà¤¾à¤°"},
{id:"technology",en:"Tech/AI",hi:"à¤¤à¤•à¤¨à¥€à¤•"},
{id:"sports",en:"Sports",hi:"à¤–à¥‡à¤²"},
{id:"miscellaneous",en:"Miscellaneous",hi:"à¤µà¤¿à¤µà¤¿à¤§"}
];

function renderCategories(){
document.getElementById("catBar").innerHTML=
categories.map(c=>`
<button class="cat-btn ${state.category===c.id?"active":""}"
onclick="setCategory('${c.id}')">
${state.lang==="en"?c.en:c.hi}
</button>`).join("");

document.getElementById("catInput").innerHTML=
categories.map(c=>`
<option value="${c.id}">
${state.lang==="en"?c.en:c.hi}
</option>`).join("");
}

function toggleLang(){
state.lang=state.lang==="en"?"hi":"en";
document.getElementById("appLogo").innerText=
state.lang==="en"?"Shabadam":"à¤¶à¤¬à¥à¤¦à¤®à¥";
reset();
renderCategories();
fetchNews();
loadBreaking();
}

function setCategory(cat){
state.category=cat;
reset();
renderCategories();
fetchNews();
}

function reset(){
state.page=1;
state.finished=false;
document.getElementById("feed").innerHTML="";
}

function summarizeText(text){
if(!text) return "";
let words=text.split(" ");
return words.slice(0,60).join(" ")+"...";
}

/* TIME AGO FORMAT */
function timeAgo(date){
const seconds=Math.floor((new Date()-new Date(date))/1000);
let interval=Math.floor(seconds/3600);
if(interval>=1) return interval+" hr"+(interval>1?"s":"")+" ago";
interval=Math.floor(seconds/60);
if(interval>=1) return interval+" min"+(interval>1?"s":"")+" ago";
return "Just now";
}

async function fetchNews(){
if(state.loading||state.finished)return;
state.loading=true;

try{
const res=await fetch(`/api/news?page=${state.page}&category=${state.category}&lang=${state.lang}`);
const data=await res.json();

if(data.articles?.length){
render(data.articles);
state.page++;
}else{
state.finished=true;
}
}catch(e){}
state.loading=false;
}

function render(articles){
const feed=document.getElementById("feed");
articles.forEach(a=>{
feed.innerHTML+=`
<div class="card">
<img src="${a.image||'https://picsum.photos/600/300'}">
<div class="info">
<div class="title">
<a href="article.html?id=${a._id}" style="text-decoration:none;color:inherit;">
${a.title}
</a>
</div>
<div class="desc">${summarizeText(a.description||"")}</div>
<div class="date">${timeAgo(a.createdAt||a.publishedAt)}</div>
<a href="article.html?id=${a._id}" class="read-btn">
${state.lang==="en"?"Read More":"à¤ªà¥‚à¤°à¤¾ à¤ªà¤¢à¤¼à¥‡à¤‚"}
</a>
<button class="share-btn" onclick="shareNews('${a.title}','https://shabadam.com/article.html?id=${a._id}')">
Share
</button>
</div>
</div>`;
});
}

/* Infinite Scroll */
window.addEventListener("scroll",()=>{
if((window.innerHeight+window.scrollY)>=document.body.offsetHeight-200){
fetchNews();
}
});

/* Share */
function shareNews(title,url){
if(navigator.share){
navigator.share({title:title,url:url});
}else{
window.open(`https://wa.me/?text=${encodeURIComponent(title+" "+url)}`,'_blank');
}
}

/* Editor Functions (unchanged working) */
function openLogin(){loginModal.style.display="flex";}
function closeLogin(){loginModal.style.display="none";}
function openEditor(){editorModal.style.display="flex";loadManageList();}
function closeEditor(){editorModal.style.display="none";}

function editorLogin(){
if(editorUser.value===EDITOR_USERNAME && editorPass.value===EDITOR_PASSWORD){
closeLogin();openEditor();
}else alert("Invalid credentials");
}

function handleImageUpload(e){
const file=e.target.files[0];
const reader=new FileReader();
reader.onload=ev=>{
uploadedImage=ev.target.result;
previewImg.src=uploadedImage;
previewImg.style.display="block";
};
reader.readAsDataURL(file);
}

async function publishArticle(){
await fetch("/api/editor-post",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
title:titleInput.value,
description:descInput.value,
image:uploadedImage,
category:catInput.value,
lang:state.lang
})
});
alert("Published");
loadManageList();
reset();
fetchNews();
}

async function loadManageList(){
const res=await fetch(`/api/news?page=1`);
const data=await res.json();
manageList.innerHTML="";
(data.articles||[]).forEach(a=>{
manageList.innerHTML+=`
<div class="manage-item">
<span>${a.title.substring(0,20)}</span>
<button onclick="deleteArticle('${a._id}')">Del</button>
</div>`;
});
}

async function deleteArticle(id){
await fetch("/api/editor-delete?id="+id,{method:"DELETE"});
loadManageList();
reset();
fetchNews();
}

/* Breaking */
async function loadBreaking(){
const res=await fetch(`/api/news?page=1`);
const data=await res.json();
if(data.articles?.length){
breakingNews.innerText=
data.articles.slice(0,5).map(a=>a.title).join(" â€¢ ");
}
}
setInterval(loadBreaking,120000);

/* PWA Install */
let deferredPrompt;
const installBtn=document.createElement("button");
installBtn.innerText="ğŸ“² Install App";
installBtn.style.position="fixed";
installBtn.style.bottom="80px";
installBtn.style.right="20px";
installBtn.style.padding="10px 15px";
installBtn.style.borderRadius="30px";
installBtn.style.background="#E4405F";
installBtn.style.color="#fff";
installBtn.style.border="none";
installBtn.style.display="none";
document.body.appendChild(installBtn);

window.addEventListener('beforeinstallprompt',(e)=>{
e.preventDefault();
deferredPrompt=e;
installBtn.style.display="block";
});
installBtn.onclick=()=>deferredPrompt.prompt();

renderCategories();
fetchNews();
loadBreaking();

</script>
</body>
</html>
