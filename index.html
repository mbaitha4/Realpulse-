<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RealPulse</title>

<style>
:root{
--primary:#E4405F;
--bg:#f4f6f9;
--card:#ffffff;
--text:#222;
}
[data-theme="dark"]{
--bg:#121212;
--card:#1e1e1e;
--text:#e0e0e0;
}
body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text);}
header{
position:fixed;top:0;width:100%;
background:var(--card);
padding:15px;
display:flex;justify-content:space-between;align-items:center;
box-shadow:0 3px 15px rgba(0,0,0,.08);
z-index:10;
}
.logo{font-weight:900;font-size:22px;color:var(--primary);}
.lang-toggle button{
margin-left:5px;padding:6px 12px;
border:none;border-radius:20px;
cursor:pointer;font-weight:600;
}
.lang-toggle .active{
background:var(--primary);color:#fff;
}
.ticker{
margin-top:60px;
background:#000;
color:#fff;
padding:8px;
white-space:nowrap;
overflow:hidden;
}
.ticker span{
display:inline-block;
padding-left:100%;
animation:scroll 25s linear infinite;
}
@keyframes scroll{
0%{transform:translateX(0)}
100%{transform:translateX(-100%)}
}
.cat-bar{
display:flex;overflow-x:auto;padding:10px;gap:8px;
}
.cat-btn{
padding:7px 15px;border:none;border-radius:20px;
background:#ddd;cursor:pointer;font-weight:600;
}
.cat-btn.active{background:var(--primary);color:#fff;}
#feed{max-width:650px;margin:auto;padding:15px;padding-bottom:90px;}
.card{
background:var(--card);
border-radius:16px;
overflow:hidden;
margin-bottom:20px;
box-shadow:0 5px 20px rgba(0,0,0,.08);
transition:.3s;
}
.card:hover{
transform:translateY(-5px);
box-shadow:0 10px 25px rgba(0,0,0,.12);
}
.card img{
width:100%;height:220px;object-fit:cover;
}
.info{padding:15px;}
.title{
font-weight:700;font-size:18px;margin-bottom:8px;
display:block;text-decoration:none;color:var(--text);
}
.desc{font-size:14px;margin-bottom:8px;color:#555;}
.date{font-size:12px;color:#888;margin-bottom:10px;}
.read-btn{
display:inline-block;padding:8px 15px;
background:var(--primary);color:#fff;
border-radius:8px;text-decoration:none;font-size:13px;font-weight:600;
}
.loader{text-align:center;padding:20px;font-weight:600;}
</style>
</head>

<body data-theme="light">

<header>
<div class="logo">RealPulse</div>
<div class="lang-toggle">
<button id="enBtn" class="active" onclick="setLang('en')">English</button>
<button id="hiBtn" onclick="setLang('hi')">Hindi</button>
<button onclick="toggleTheme()">ðŸŒ™</button>
</div>
</header>

<div class="ticker"><span id="breakingNews">Loading breaking news...</span></div>
<div class="cat-bar" id="catBar"></div>
<div id="feed"></div>
<div id="loader" class="loader">Loading...</div>

<script>
let state={page:1,category:"General",lang:"en",loading:false,finished:false};
const categories=["General","Nation","Business","Technology","Sports","Miscellaneous"];

function renderCategories(){
document.getElementById("catBar").innerHTML=
categories.map(c=>`<button class="cat-btn ${state.category===c?"active":""}"
onclick="setCategory('${c}')">${c}</button>`).join("");
}

function setCategory(cat){state.category=cat;reset();fetchNews();}
function setLang(l){
state.lang=l;
document.getElementById("enBtn").classList.toggle("active",l==="en");
document.getElementById("hiBtn").classList.toggle("active",l==="hi");
reset();fetchNews();fetchBreaking();
}
function reset(){state.page=1;state.finished=false;document.getElementById("feed").innerHTML="";}
function toggleTheme(){document.body.setAttribute("data-theme",
document.body.getAttribute("data-theme")==="dark"?"light":"dark");}

async function fetchNews(){
if(state.loading||state.finished)return;
state.loading=true;

const res=await fetch(`/api/news?page=${state.page}&category=${state.category.toLowerCase()}&lang=${state.lang}`);
const data=await res.json();

if(data.articles?.length){
render(data.articles);
state.page++;
}else{
state.finished=true;
document.getElementById("loader").innerText="No more news";
}
state.loading=false;
}

function render(articles){
const feed=document.getElementById("feed");
articles.forEach(a=>{
feed.innerHTML+=`
<div class="card">
<img src="${a.image||'https://picsum.photos/600/300'}">
<div class="info">
<a href="${a.url}" target="_blank" class="title">${a.title}</a>
<div class="desc">${(a.description||"").substring(0,150)}...</div>
<div class="date">${new Date(a.publishedAt).toLocaleDateString()}</div>
<a href="${a.url}" target="_blank" class="read-btn">Read More</a>
</div>
</div>`;
});
}

window.addEventListener("scroll",()=>{
if(window.innerHeight+window.scrollY>=document.body.offsetHeight-200){
fetchNews();
}
});

async function fetchBreaking(){
const res=await fetch(`/api/news?page=1&category=general&lang=${state.lang}`);
const data=await res.json();
if(data.articles?.length){
document.getElementById("breakingNews").innerText=
data.articles.slice(0,5).map(a=>a.title).join(" â€¢ ");
}
}
setInterval(fetchBreaking,300000);

renderCategories();
fetchNews();
fetchBreaking();
</script>

</body>
</html>
