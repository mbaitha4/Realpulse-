<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RealPulse</title>

<style>
:root{
--primary:#E4405F;
--bg:#f4f6f9;
--card:#ffffff;
--text:#222;
}
[data-theme="dark"]{
--bg:#121212;
--card:#1e1e1e;
--text:#e0e0e0;
}
body{
margin:0;
font-family:system-ui;
background:var(--bg);
color:var(--text);
}

header{
position:fixed;
top:0;
width:100%;
background:var(--card);
padding:15px;
display:flex;
justify-content:space-between;
align-items:center;
box-shadow:0 3px 15px rgba(0,0,0,.08);
z-index:1000;
}

.logo{
font-weight:900;
font-size:22px;
color:var(--primary);
}

.lang-btn{
padding:6px 14px;
border:none;
border-radius:20px;
font-weight:600;
cursor:pointer;
background:var(--primary);
color:#fff;
margin-right:15px;
}

.ticker{
margin-top:65px;
background:#000;
color:#fff;
padding:8px;
overflow:hidden;
white-space:nowrap;
}

.ticker span{
display:inline-block;
padding-left:100%;
animation:scroll 25s linear infinite;
}

@keyframes scroll{
0%{transform:translateX(0)}
100%{transform:translateX(-100%)}
}

#feed{
max-width:650px;
margin:auto;
padding:15px;
padding-bottom:90px;
}

.card{
background:var(--card);
border-radius:16px;
overflow:hidden;
margin-bottom:20px;
box-shadow:0 5px 20px rgba(0,0,0,.08);
}

.card img{
width:100%;
height:220px;
object-fit:cover;
}

.info{
padding:15px;
}

.title{
font-weight:700;
font-size:18px;
margin-bottom:8px;
}

.desc{
font-size:14px;
margin-bottom:8px;
}

.date{
font-size:12px;
color:#888;
margin-bottom:10px;
}

.read-btn{
display:inline-block;
padding:8px 15px;
background:var(--primary);
color:#fff;
border-radius:8px;
text-decoration:none;
font-size:13px;
font-weight:600;
}

.loader{
text-align:center;
padding:20px;
font-weight:600;
}

footer{
position:fixed;
bottom:0;
width:100%;
background:var(--card);
display:flex;
justify-content:space-around;
padding:10px;
border-top:1px solid #ddd;
}
footer button{
border:none;
background:none;
font-size:16px;
cursor:pointer;
}
</style>
</head>

<body data-theme="light">

<header>
<div class="logo">RealPulse</div>
<button class="lang-btn" onclick="toggleLang()">English / ‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
</header>

<div class="ticker">
<span id="breakingNews">Loading breaking news...</span>
</div>

<div id="feed"></div>
<div id="loader" class="loader">Loading...</div>

<footer>
<button onclick="location.reload()">üè†</button>
<button onclick="toggleTheme()">üåô</button>
</footer>

<script>
let state={page:1,lang:"en",loading:false,finished:false};

/* Toggle Language */
function toggleLang(){
state.lang = state.lang==="en"?"hi":"en";
reset();
fetchNews();
loadBreaking();
}

/* Dark Mode */
function toggleTheme(){
document.body.setAttribute("data-theme",
document.body.getAttribute("data-theme")==="dark"?"light":"dark");
}

/* Reset Feed */
function reset(){
state.page=1;
state.finished=false;
document.getElementById("feed").innerHTML="";
document.getElementById("loader").innerText="Loading...";
}

/* Fetch News */
async function fetchNews(){
if(state.loading||state.finished) return;
state.loading=true;

try{
const res=await fetch(`/api/news?page=${state.page}&lang=${state.lang}`);
const data=await res.json();

console.log("API Response:",data);

if(data.articles && data.articles.length>0){
render(data.articles);
state.page++;
}else{
state.finished=true;
document.getElementById("loader").innerText=
state.lang==="en"?"No more news":"‡§î‡§∞ ‡§∏‡§Æ‡§æ‡§ö‡§æ‡§∞ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç";
}
}catch(err){
console.error("Fetch Error:",err);
document.getElementById("loader").innerText="Error loading news";
}

state.loading=false;
}

/* Render News */
function render(articles){
const feed=document.getElementById("feed");
articles.forEach(a=>{
feed.innerHTML+=`
<div class="card">
<img src="${a.image || 'https://picsum.photos/600/300'}">
<div class="info">
<div class="title">${a.title}</div>
<div class="desc">${(a.description||"").substring(0,150)}...</div>
<div class="date">${new Date(a.createdAt||a.publishedAt).toLocaleDateString()}</div>
<a href="${a.url||'#'}" target="_blank" class="read-btn">
${state.lang==="en"?"Read More":"‡§™‡•Ç‡§∞‡§æ ‡§™‡§¢‡§º‡•á‡§Ç"}
</a>
</div>
</div>`;
});
}

/* Breaking News */
async function loadBreaking(){
try{
const res=await fetch(`/api/news?page=1&lang=${state.lang}`);
const data=await res.json();

if(data.articles && data.articles.length>0){
document.getElementById("breakingNews").innerText=
data.articles.slice(0,5).map(a=>a.title).join(" ‚Ä¢ ");
}else{
document.getElementById("breakingNews").innerText="No breaking news available";
}
}catch(err){
document.getElementById("breakingNews").innerText="Error loading breaking news";
}
}

setInterval(loadBreaking,120000);

/* Infinite Scroll */
window.addEventListener("scroll",()=>{
if(window.innerHeight+window.scrollY>=document.body.offsetHeight-200){
fetchNews();
}
});

/* Initial Load */
fetchNews();
loadBreaking();
</script>

</body>
</html>
